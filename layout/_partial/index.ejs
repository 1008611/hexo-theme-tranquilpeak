<% var thumbnailImageUrl = null; %>
<!-- Define default position to right for the thumbnail image -->
<% var thumbnailImagePosition = "right"; %>

<section class="postShorten-group main-content-wrap">
    <% page.posts.each(function(post) { %>
        <!-- Define thumbnail image -->
        <% if (theme.thumbnail_image && post.thumbnailImage && post.thumbnailImage.length) { %>
            <% if (post.thumbnailImage.indexOf(config.url) < 0 && post.thumbnailImage.indexOf('://') >= 0) { %>
                <% thumbnailImageUrl = post.thumbnailImage; %>
            <% } else { %>
                <% thumbnailImageUrl = url_for(post.permalink + post.thumbnailImage); %>
            <% } %>
        <!-- Define third images (cover image and first photo) as thumbnail image -->
        <% } else if (theme.thumbnail_image && (post.autoThumbnailImage === true ||
            (theme.auto_thumbnail_image === true && post.autoThumbnailImage !== false))) { %>
            <% if (post.photos && post.photos.length) { %>
                <% if (post.photos[0].indexOf(config.url) < 0 && post.photos[0].indexOf('://') >= 0) { %>
                    <% thumbnailImageUrl = post.photos[0]; %>
                <% } else { %>
                    <% thumbnailImageUrl = url_for(post.permalink + post.photos[0]); %>
                <% } %>
            <% } else if (post.coverImage && post.coverImage.length) { %>
                <% if (post.coverImage.indexOf(config.url) < 0 && post.coverImage.indexOf('://') >= 0) { %>
                    <% thumbnailImageUrl = post.coverImage; %>
                <% } else { %>
                    <% thumbnailImageUrl = url_for(post.permalink + post.coverImage); %>
                <% } %>
            <% } %>
        <% } %>
        <!-- Define  -->
        <% if (thumbnailImageUrl !== null) { %>
            <% if (post.thumbnailImagePosition && post.thumbnailImagePosition.length)  { %>
                <% thumbnailImagePosition = post.thumbnailImagePosition; %>
            <% } else if (theme.thumbnail_image_position && theme.thumbnail_image_position.length) { %>
                <% thumbnailImagePosition = theme.thumbnail_image_position; %>
            <% } %>
        <% } %>
        <article class="postShorten postShorten--thumbnailimg-<%= thumbnailImagePosition %>" itemscope itemType="http://schema.org/BlogPosting">
            <div class="postShorten-wrap">
                <div class="postShorten-header">
                    <h1 class="postShorten-title" itemprop="headline">
                        <% if (post.link) { %>
                                <a class="link-unstyled" href="<%- url_for(post.link) %>"><%= post.title || '(' + __('post.no_title') + ')' %></a>
                        <% } else { %>
                                <a class="link-unstyled" href="<%- url_for(post.path) %>"><%= post.title || '(' + __('post.no_title') + ')' %></a>
                        <% } %>
                    </h1>
                    <%- partial('post/meta', {post: post, classes: ['postShorten-meta']}) %>
                </div>
                <% if (thumbnailImageUrl !== null &&
                    (post.thumbnailImagePosition === "bottom" ||
                    (theme.thumbnail_image_position === "bottom" && post.thumbnailImagePosition !== "right"))) { %>
                    <div class="postShorten-thumbnailimg postShorten-thumbnailimg--bottom">
                        <img alt="" itemprop="image" src="<%= thumbnailImageUrl %>"/>
                    </div>
                    <% thumbnailImageUrl = null; %>
                <% } %>

                <div class="postShorten-excerpt" itemprop="articleBody">
                    <% if (post.excerpt) { %>
                        <%- post.excerpt %>
                    <% } else { %>
                        <p>
                            <%- post.content %>
                    <% } %>
                    <% if (post.link && __('post.go_to_website')) { %>
                            <a href="<%- url_for(post.link) %>" target="new" class="postShorten-excerpt_link link"><%= __('post.go_to_website')  %> </a>
                    <% } else { %>
                        <% if (__('post.read_more')) { %>
                            <a href="<%- url_for(post.path) %>" class="postShorten-excerpt_link link "><%- __('post.read_more') %></a>
                            <% if (post.readingtime) { %>
                                <span class="postShorten-readingtime"><%= ' - ' + post.readingtime + ' min read' %></span>
                            <% } %>
                        <% } %>
                    <% } %>
                    <% if (!post.excerpt) { %>
                        </p>
                    <% } %>
                </div>
            </div>
            <% if (thumbnailImageUrl !== null &&
                    ((post.thumbnailImagePosition === "right" || post.thumbnailImagePosition === "left") ||
                    ((theme.thumbnail_image_position === "right" || theme.thumbnail_image_position === "left") &&
                    post.thumbnailImagePosition !== "bottom"))) { %>
                <div class="postShorten-thumbnailimg">
                    <img alt="" itemprop="image" src="<%= thumbnailImageUrl %>"/>
                </div>
                <% thumbnailImageUrl = null; %>
            <% } %>
        </article>
    <% }) %>
    <%- partial('pagination', {type: 'page'}) %>
</section>
